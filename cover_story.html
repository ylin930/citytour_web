<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>City Tour – Cover Story</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="styles.css" />
        <style>
            /* keep it tidy and unskippable */
            .video-wrap {
                position: relative;
                width: 100%;
                max-width: 820px;
                margin: 0 auto;
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                background: #000;
            }
            video {
                display: block;
                width: 100%;
                height: auto;
                background: #000;
                /* no native controls */
            }
            /* overlay play button shown only if autoplay is blocked */
            .overlay {
                position: absolute;
                inset: 0;
                display: grid;
                place-items: center;
                background: rgba(0, 0, 0, 0.35);
                pointer-events: auto;
            }
            .overlay.hidden {
                display: none;
            }
            .overlay .play {
                padding: 12px 20px;
                border-radius: 999px;
                background: white;
                font-weight: 600;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                user-select: none;
            }
            /* subtle hint text area */
            #msg {
                text-align: center;
                min-height: 20px;
                opacity: 0.8;
            }
        </style>
    </head>

    <body>
        <main class="container">
            <header class="header">
                <div>
                    <div class="badge">CITY TOUR • INTRO</div>
                    <div class="h1">Cover story</div>
                    <div class="sub">Please watch the short intro video. Click "Next" when it ends.</div>
                </div>
            </header>

            <section class="grid">
                <div class="card" style="display: flex; flex-direction: column; gap: 14px; align-items: center">
                    <div class="video-wrap">
                        <video
                            id="coverVideo"
                            autoplay
                            muted
                            playsinline
                            preload="auto"
                            controlslist="nodownload noplaybackrate nofullscreen"
                            disablepictureinpicture>
                            <source id="coverSrc" type="video/mp4" />
                        </video>

                        <!-- Shown if autoplay is blocked; click to start -->
                        <div id="overlay" class="overlay hidden">
                            <div class="play">Play</div>
                        </div>
                    </div>

                    <div id="msg"></div>

                    <div class="buttons" style="justify-content: flex-end; width: 100%">
                        <button class="btn" type="button" onclick="history.back()">Back</button>
                        <button id="nextBtn" class="btn primary" type="button" disabled>Next</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- make sure this is included BEFORE you call storageURL -->
        <script src="/js/firebase-config.js"></script>

        <script>
            function storageURL(path) {
                const bucket = window.FB_CONFIG && window.FB_CONFIG.storageBucket;
                if (!bucket) throw new Error("Missing storageBucket in FB_CONFIG");
                return `https://firebasestorage.googleapis.com/v0/b/${bucket}/o/${encodeURIComponent(path)}?alt=media`;
            }
            // set the video source
            const srcEl = document.getElementById("coverSrc"); // <source id="coverSrc">
            srcEl.src = storageURL("media/cover/CT_cover.mp4");
            document.getElementById("coverVideo").load();
        </script>
    </body>
</html>
