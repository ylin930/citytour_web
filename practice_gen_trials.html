<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>City 0 – Generator Practice</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .choice-grid { display:grid; grid-template-columns: repeat(3, minmax(160px, 1fr)); gap:16px; align-items:center; }
    .choice { border:2px solid transparent; border-radius:14px; padding:10px; cursor:pointer; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,.08); }
    .choice.selected { border-color:#2563eb; box-shadow:0 8px 20px rgba(37,99,235,.25); }
    .anim { width:100%; aspect-ratio:4/3; background:#000; border-radius:10px; overflow:hidden; }
  </style>
</head>
<body>
  <main class="container">
    <header class="header">
      <div>
        <div class="badge">CITY 0 • PRACTICE</div>
        <div class="h1">Pick the matching animation</div>
        <div class="sub">Tap one option, then press Submit.</div>
      </div>
    </header>

    <section class="grid">
      <div class="card" style="display:flex;flex-direction:column;gap:16px;">
        <div id="trialCounter" class="muted">Trial 1</div>

        <div id="choices" class="choice-grid"></div>

        <div class="buttons" style="justify-content:space-between">
          <button class="btn" type="button" onclick="history.back()">Back</button>
          <div style="display:flex; gap:10px">
            <button id="submitBtn" class="btn primary" disabled>Submit</button>
            <button id="nextBtn" class="btn" disabled>Next</button>
          </div>
        </div>

        <div id="feedback" class="muted"></div>
      </div>
    </section>
  </main>

  <script>
    const TRIALS = [{"trial": 1, "event_id": 1, "choices": [3, 2, 1], "correct": 3}, {"trial": 2, "event_id": 2, "choices": [2, 1, 3], "correct": 1}, {"trial": 3, "event_id": 3, "choices": [1, 3, 2], "correct": 2}];

    let idx = 0;
    let selected = null;

    const choicesEl = document.getElementById('choices');
    const trialCounter = document.getElementById('trialCounter');
    const submitBtn = document.getElementById('submitBtn');
    const nextBtn = document.getElementById('nextBtn');
    const feedback = document.getElementById('feedback');

    function animPath(n) { return 'media/City0/animations/${n}.mp4'; }

    function renderTrial() {
      const t = TRIALS[idx];
      trialCounter.textContent = 'Trial ' + (idx+1) + ' of ' + TRIALS.length;
      feedback.textContent = "";
      submitBtn.disabled = true;
      nextBtn.disabled = true;
      selected = null;

      choicesEl.innerHTML = "";
      t.choices.forEach((n) => {
        const card = document.createElement('div');
        card.className = 'choice';
        card.dataset.value = n;

        const vid = document.createElement('video');
        vid.className = 'anim';
        vid.muted = true;
        vid.loop = true;
        vid.playsInline = true;
        vid.autoplay = true;
        const src = document.createElement('source');
        src.src = animPath(n);
        src.type = 'video/mp4';
        vid.appendChild(src);

        const label = document.createElement('div');
        label.style.textAlign = 'center';
        label.style.padding = '6px 0 2px';
        label.textContent = 'Option ' + n;

        card.appendChild(vid);
        card.appendChild(label);
        card.addEventListener('click', () => {
          document.querySelectorAll('.choice').forEach(el => el.classList.remove('selected'));
          card.classList.add('selected');
          selected = n;
          submitBtn.disabled = false;
        });

        choicesEl.appendChild(card);
      });
    }

    submitBtn.addEventListener('click', () => {
      const t = TRIALS[idx];
      if (selected == null) return;
      const correct = Number(t.correct) === Number(selected);
      feedback.textContent = correct ? '✅ Correct!' : ('❌ Incorrect. Correct answer: ' + t.correct);
      nextBtn.disabled = false;
      submitBtn.disabled = true;
    });

    nextBtn.addEventListener('click', () => {
      idx += 1;
      if (idx >= TRIALS.length) {
        window.location.href = 'session_video.html?session=1';
      } else {
        renderTrial();
      }
    });

    // init
    renderTrial();
  </script>
  <script src="js/dev-tools.js"></script>
</body>
</html>
